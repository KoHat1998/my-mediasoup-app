<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Watch â€¢ Livenix</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#ffffff" />
  <link rel="stylesheet" href="/style.css" />
  <link rel="icon" href="/favicon.ico" />
</head>
<body>
  <!-- Header -->
  <header class="header">
    <a href="/lives.html" class="brand" aria-label="Livenix home">
      <img src="/assets/livenix.svg" alt="" style="height:20px;vertical-align:middle;margin-right:8px;display:inline-block" onerror="this.style.display='none'">
      Livenix
    </a>
    <div class="actions" style="margin-left:auto; display:flex; align-items:center; gap:10px;">
      <button id="browse" class="btn ghost" aria-label="Browse lives">Browse Lives</button>
      <button id="signout" class="btn" aria-label="Sign out">Sign out</button>
    </div>
  </header>

  <!-- Auth guard: viewers must be signed in -->
  <script>
    (function requireAuth(){
      const token = localStorage.getItem('token') || localStorage.getItem('authToken');
      if (!token) location.href = '/signin.html';
    })();
  </script>

  <!-- Main -->
  <main class="main">
    <section class="card" style="max-width:1100px; margin:0 auto; padding:16px;">
      <div style="display:flex; align-items:baseline; gap:12px; flex-wrap:wrap;">
        <h2 style="margin:0; font-size:1.4rem;">Viewer</h2>
        <p id="status" class="small" style="margin:0; opacity:.85;"></p>
      </div>

      <!-- Player wrapper -->
      <div class="player" id="player" style="margin-top:12px;">
        <!-- top-left badges -->
        <div class="overlay top-left" style="display:flex; gap:8px;">
          <span id="live" class="badge">Checkingâ€¦</span>
          <span id="vc" class="badge" aria-live="polite">ðŸ‘€ 0</span>
        </div>

        <video
          id="remote"
          autoplay
          playsinline
          controls
          controlslist="nodownload noplaybackrate noremoteplayback"
          disablepictureinpicture
          disableremoteplayback
          style="width:100%; background:#000; border-radius:12px;"
        ></video>
      </div>

      <!-- Toolbar (quality) -->
      <div class="toolbar" style="margin-top:12px; display:flex; align-items:center; gap:10px; flex-wrap:wrap;">
        <label for="qualitySel" class="small" style="opacity:.9;">Quality</label>
        <select id="qualitySel" class="btn" style="background:var(--bg-soft); color:inherit; border:1px solid var(--border);">
          <option value="auto">Auto</option>
          <option value="high">High</option>
          <option value="med">Medium</option>
          <option value="low">Low</option>
        </select>
      </div>

      <div id="skel" class="skel" style="margin:12px auto 0;"></div>

      <!-- Readouts under the player -->
      <div class="badges" style="justify-content:center; margin-top:8px;">
        <span id="res" class="badge">â€“</span>
        <span id="quality" class="badge">â€“</span>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <small>Â© 2025 Livenix</small>
    <nav style="display:flex; gap:14px;">
      <a href="#">Terms</a>
      <a href="#">Privacy</a>
      <a href="#">Contact</a>
    </nav>
  </footer>

  <div id="toast" class="toast"></div>

  <!-- Scripts -->
  <script src="/socket.io/socket.io.js"></script>
  <script type="module">
    // Header actions
    document.getElementById('browse').onclick = () => location.href = '/lives.html';
    document.getElementById('signout').onclick = () => { localStorage.clear(); location.href = '/signin.html'; };

    // Guard for slug: viewer joins by ?slug=your-live-slug
    const slug = new URLSearchParams(location.search).get('slug');
    if (!slug) {
      const s = document.getElementById('status');
      s.textContent = 'Missing live slug. Open from the Live List.';
    }
  </script>
  <script type="module" src="/viewer.js"></script>
</body>
</html>