<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Watch â€¢ KoHat Live</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <!-- Header -->
  <header class="header">
    <a href="/lives.html" class="brand">ðŸŽ¥ KoHat Live</a>
    <div class="actions">
      <button id="browse" class="btn ghost">Browse Lives</button>
      <button id="signout" class="btn">Sign out</button>
    </div>
  </header>

  <!-- Auth guard: viewers must be signed in -->
  <script>
    (function requireAuth(){
      const token = localStorage.getItem('token');
      if (!token) location.href = '/signin.html';
    })();
  </script>

  <main class="main">
    <section class="card">
      <h2 style="margin-top:0">Viewer</h2>

      <!-- player wrapper -->
      <div class="player" id="player">
        <!-- top-left badges -->
        <div class="overlay top-left">
          <span id="live" class="badge">Checkingâ€¦</span>
          <span id="vc" class="badge">ðŸ‘€ 0</span>
        </div>

        <video
          id="remote"
          autoplay
          playsinline
          controls
          controlslist="nodownload noplaybackrate noremoteplayback"
          disablepictureinpicture
          disableremoteplayback
        ></video>
      </div>

      <!-- outside toolbar (quality) -->
      <div class="toolbar">
        <label for="qualitySel">Quality</label>
        <select id="qualitySel">
          <option value="auto">Auto</option>
          <option value="high">High</option>
          <option value="med">Medium</option>
          <option value="low">Low</option>
        </select>
      </div>

      <div id="skel" class="skel" style="margin:12px auto 0;"></div>

      <!-- small readouts under the player -->
      <div class="badges" style="justify-content:center">
        <span id="res" class="badge">â€“</span>
        <span id="quality" class="badge">â€“</span>
      </div>

      <p id="status" style="margin-top:8px; opacity:.85; text-align:center"></p>
    </section>
  </main>

  <footer class="footer">
    <small>Â© 2025 KoHat Live</small>
    <nav>
      <a href="#">Terms</a>
      <a href="#">Privacy</a>
      <a href="#">Contact</a>
    </nav>
  </footer>

  <div id="toast" class="toast"></div>

  <script src="/socket.io/socket.io.js"></script>
  <script type="module">
    // Header actions
    document.getElementById('browse').onclick = () => location.href = '/lives.html';
    document.getElementById('signout').onclick = () => { localStorage.clear(); location.href = '/signin.html'; };

    // Guard for slug: viewer joins by ?slug=your-live-slug
    const slug = new URLSearchParams(location.search).get('slug');
    if (!slug) {
      const s = document.getElementById('status');
      s.textContent = 'Missing live slug. Open from the Live List.';
    }
  </script>
  <script type="module" src="/viewer.js"></script>
</body>
</html>