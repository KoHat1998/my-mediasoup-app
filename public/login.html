<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Login â€¢ KoHat Live</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <header class="header">
    <a href="/" class="brand">ðŸŽ¥ KoHat Live</a>
    <div class="actions">
      <!-- Direct link for viewers; broadcasters land here to sign in -->
      <a class="btn big ghost" href="/viewer.html">Watch Live</a>
    </div>
  </header>

  <main class="main">
    <section class="card">
      <h2 style="margin-top:0">Admin Login</h2>
      <p style="opacity:.85">Sign in as <strong>b1</strong> (Broadcaster 1) or <strong>b2</strong> (Broadcaster 2).</p>

      <form method="post" action="/login"
            style="margin-top:12px; display:flex; flex-direction:column; gap:10px; align-items:center"
            autocomplete="off">
        <input id="username" name="username" placeholder="b1 or b2" required
               inputmode="text" autocapitalize="none" spellcheck="false"
               style="padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,.25); width:260px; background:rgba(0,0,0,.2); color:#fff">
        <input name="password" type="password" placeholder="password" required
               autocomplete="current-password"
               style="padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,.25); width:260px; background:rgba(0,0,0,.2); color:#fff">
        <button class="btn big" type="submit">Login</button>
      </form>

      <!-- Status / error messages -->
      <p id="msg" style="margin-top:8px; min-height:1.2em"></p>
      <script>
        (function () {
          const p = new URLSearchParams(location.search);
          const msg = document.getElementById('msg');
          const usernameEl = document.getElementById('username');

          // Pre-fill username if ?ch=b1|b2 provided
          const ch = p.get('ch');
          if (ch === 'b1' || ch === 'b2') usernameEl.value = ch;

          // Messages
          const err = p.get('err');
          const ok = p.get('ok');
          const bye = p.get('bye');

          let text = '';
          let color = '#fca5a5'; // red-ish for errors by default

          if (err === '1') {
            text = 'Invalid username or password.';
          } else if (err === 'busy') {
            text = 'This broadcaster is already signed in. Please try again later or ask them to log out.';
          } else if (err === 'expired') {
            text = 'Your session expired. Please sign in again.';
          } else if (ok === '1' || bye === '1') {
            text = 'You have been logged out.';
            color = '#a7f3d0'; // green-ish for success
          }

          msg.textContent = text;
          msg.style.color = color;
        })();
      </script>
    </section>
  </main>

  <footer class="footer">
    <small>Â© 2025 KoHat Live</small>
  </footer>
</body>
</html>
